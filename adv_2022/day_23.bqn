BN←∨˝∘(«˘∾⊢≍»˘)∘»
BA←{⟨BN𝕩,BN⌾⌽𝕩,BN⌾⍉𝕩,BN⌾(⌽∘⍉)𝕩⟩}
M←{𝕊[n,s,w,e]:[«n,»s,«˘w,»˘e];𝕊⁼[n,s,w,e]:[»n,«s,»˘w,«˘e]}
HN←{𝕩∧1<>+˝⥊1‿0‿¯1⌽⌜1‿0‿¯1⌽˘⌜<𝕩}
Step←{MF←M⌾((-𝕨)⊸⌽)⋄𝕩{um←(>{<1<+˝𝕩}{𝕨∧<𝕩}˘⊢)⌾MF𝕩⋄mv←𝕩-um⋄og←𝕨∧(¬∨˝mv∾um)⋄og∨∨˝𝕩MF{𝕩∨(𝔽𝕨∧¬𝕩)}um}(∊⎉1⌾⍉∧⊢)>𝕨⌽(¬BA𝕩)∧<𝕩}
idx←¯1
data←50 {(-𝕨)⌽˘(-𝕨)⌽𝕩↑˜(2×𝕨)+≢𝕩} '#'=>•Flines"input_23.txt"
•Show {(+´⥊𝕩)-˜×´1+(⌈´-⌊´)𝕩/○⥊↕≢𝕩} data↩{idx+↩1⋄(𝕩∧¬HN𝕩) ∨ (4|idx) Step HN 𝕩}⍟10 data
{idx+↩1⋄(𝕩∧¬HN𝕩) ∨ (4|idx) Step HN 𝕩}{𝕊∘⊢⍟≢⟜𝔽𝕩} data
•Show 1+idx
